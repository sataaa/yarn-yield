/*

Parchment
=========

Built: 2012-04-06

Copyright (c) 2008-2011 The Parchment Contributors
BSD licenced
http://code.google.com/p/parchment

*/
(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object.subClass=function(g){var f=this.prototype,e=f,d,c;a=true;e=new this();a=false;for(d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super,j;this._super=f[h];j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}c=e.init?function(){if(!a){this.init.apply(this,arguments)}}:function(){};c.prototype=e;c.constructor=c;c.subClass=Object.subClass;return c}})();(function(){function b(h,i){return h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3]}function c(h){return[(h>>24)&255,(h>>16)&255,(h>>8)&255,h&255]}function e(h,i){return String.fromCharCode(h[i],h[i+1],h[i+2],h[i+3])}function g(h){return[h.charCodeAt(0),h.charCodeAt(1),h.charCodeAt(2),h.charCodeAt(3)]}var f=Object.subClass({init:function a(k){this.type="";this.chunks=[];if(k){if(e(k,0)!="FORM"){throw new Error("Not an IFF file")}this.type=e(k,8);var j=12,h=k.length;while(j<h){var m=b(k,j+4);if(m<0||(m+j)>h){throw new Error("IFF: Chunk out of range")}this.chunks.push({type:e(k,j),offset:j,data:k.slice(j+8,j+8+m)});j+=8+m;if(m%2){j++}}}},write:function d(){var m=g(this.type);for(var n=0,j=this.chunks.length;n<j;n++){var k=this.chunks[n],o=k.data,h=o.length;m=m.concat(g(k.type),c(h),o);if(h%2){m.push(0)}}return g("FORM").concat(c(m.length),m)}});f.num_from=b;f.num_to_word=c;f.text_from=e;f.text_to_word=g;window.IFF=f})();(function(h,c,e){var o=function(t,v){for(var u in v){t[u]=v[u]}return t},k=function(t){t.css({color:t.css("bgcolor"),"background-color":t.css("color")})},j=/inh|tra|(\d+, ?){3}0/,i=c(h),g=c(document),l,q;c(function(){l=c("body");q=parseFloat(l.css("line-height"))});o(c.cssHooks,{bgcolor:{get:function(v){var t=c(v),u=t.css("background-color");if(j.test(u)){return t.parent().css("bgcolor")}return u},set:function(v,w){var t=c(v),u=t.parent();t.css("background-color",w);if(j.test(u.css("background-color"))){u.css("bgcolor",w)}}}});var f=h.scrollByPages||function(u){var t=document.documentElement.clientHeight,v=t-Math.min(t/10,q*2);scrollBy(0,v*u)},s=h.getSelection||function(){return document.selection?document.selection.createRange().text:""},b=Object.subClass({init:function(t,w){var v=this,u=c("<input>",{"class":"TextInput",autocapitalize:"off",keydown:function(y){var z=v.keyCode=y.which,x;if(v.mode!="line"){return}if(z==38){v.prev_next(1);x=1}if(z==40){v.prev_next(-1);x=1}if(z==33){f(-1);x=1}if(z==34){f(1);x=1}if(z==13){v.submitLine();x=1}y.stopPropagation();if(x){return false}},keypress:function(x){if(v.mode=="char"){v.charCode=x.which;v.submitChar();return false}},keyup:function(){if(v.mode=="char"){v.submitChar()}}});v.lastinput=c('<span class="lastinput"/>').appendTo(t);g.on("click.TextInput keydown.TextInput",function(x){if(x.target.nodeName!="INPUT"&&s()==""){if(i.scrollTop()+i.height()-u.offset().top>-60){h.scrollTo(0,9000000000);x.target=u[0];u.focus().trigger(x);x.stopPropagation()}else{if(x.type=="keydown"&&x.which==8){return false}}}});v.history=[];v.input=u;v.container=t;v.statuswin=c("<div>");if(w){v.scrollParent=c(w)}else{v.scrollParent=c.browser.webkit?l:c("html")}},die:function(){g.off(".TextInput")},scroll:function(){this.scrollParent.scrollTop(this.lastinput.position().top-this.statuswin.height()-q);this.scrollParent.scrollLeft(0)},getLine:function(u){var w=u.target.children().last(),v=this.input,t;this.order=u;this.mode="line";this.current=0;this.mutable_history=this.history.slice();this.mutable_history.unshift("");t=/^([\s\S]+<br>)(.+?)$/.exec(w.html());if(t){w.html(t[1]);t=w.clone().html(t[2]).appendTo(w)}else{t=w}v.width(20).val("").appendTo(t).width(u.target.offset().left+u.target.width()-v.offset().left);this.scroll()},submitLine:function(){var t=this.input.val();this.lastinput.appendTo(this.input.parent());this.input.detach();if(t!=this.history[0]&&/\S/.test(t)){this.history.unshift(t)}g.trigger({type:"TextInput",mode:"line",input:t});this.mode=0;this.order.response=t;this.order.terminator=13;this.callback(this.order)},prev_next:function(x){var t=this.input,u=this.mutable_history,v=this.current,w=v+x;if(w<u.length&&w>=0){u[v]=t.val();t.val(u[w]);this.current=w}},getChar:function(t){this.order=t;this.mode="char";this.keyCode=this.charCode=0;this.input.addClass("CharInput").appendTo(this.container);this.scroll()},submitChar:function(){var v=this.keyCode,t=this.charCode,u={keyCode:v,charCode:t};if(!v&&!t){return}this.input.detach().removeClass("CharInput");g.trigger({type:"TextInput",mode:"char",input:u});this.mode=0;this.order.response=u;this.callback(this.order)}});var a=Object.subClass({init:function(u,v){var t=this;this.semanticcolor=v.env.semanticcolor;this.elem=u.addClass("TextGrid").on("stream",function(w){t.stream(w.order.data);return false});if(!this.semanticcolor){this.elem.css("bgcolor","inherit")}this.lineheight=v.env.charheight;this.io=v;v.TextInput.statuswin=this.elem;this.lines=[];this.styles=[];this.lineswanted=0;this.linesseen=0;this.linedivs=[];this.cursor=[0,0]},stream:function(y){var x,u,A,z,w=this.elem,J=this.cursor[0],v=this.cursor[1],I=this.lines,G=this.styles,B=this.io.env,H,E,D,t,F,C=I.length;for(A=0;A<y.length;A++){x=y[A];u=x.code;if(u=="height"){z=this.lineswanted;while(z<I.length){this.addline(z++)}while(x.lines>I.length){this.addline()}this.lineswanted=x.lines;if(x.lines<I.length&&!B.oldstylebox){if(x.lines!=0){while(/\S/.test(I[x.lines].join(""))&&x.lines<I.length){x.lines++}D=c("<div>").addClass("box").prependTo(this.io.target);h.scrollTo(0,9000000000);D.css({top:i.scrollTop()+this.lineheight*x.lines,left:(this.io.env.scrollparent?0:D.offset().left-1)});this.write(D,I.slice(x.lines),G.slice(x.lines))}I.length=x.lines;G.length=x.lines;if(J>x.lines-1){J=0;v=0}}}if(u=="clear"){z=0;while(z<I.length){this.addline(z++)}J=0;v=0}if(u=="cursor"){J=x.to[0];v=x.to[1];while(J>=I.length){this.addline()}if(J+1>this.lineswanted){this.lineswanted=J+1}}if(u=="get_cursor"){x.pos=[J,v];this.io.input(x)}if(u=="stream"){while(J>=I.length&&!B.oldstylebox){this.addline()}if(!this.semanticcolor){F=e;if(x.css){t=c("<tt>").appendTo(w).css(x.css);if(x.css.reverse){k(t)}F=t.attr("style");if(F){F=' style="'+F+'"'}}}else{F=e;if(x.css&&x.css.reverse){F=' class="Reverse"'}}E=x.text;z=0;while(z<E.length){D=E.charAt(z++);if(D!="\n"&&J<I.length){I[J][v]=D;G[J][v++]=F}if(D=="\n"||v==B.width){J++;v=0;if(J>=I.length&&!B.oldstylebox){this.addline()}}}}if(u=="eraseline"){for(z=v;z<B.width;z++){I[J][z]=" ";G[J][z]=e}}}this.cursor=[J,v];if(!B.oldstylebox){this.write(w,I,G)}else{this.writeoldstyle(w,I,G)}if(I.length!=C){c(".main").css("padding-top",w.height())}},write:function(z,u,y){var t="",w=0,v,A,x;while(w<u.length){A="";x=y[w][0];for(v=0;v<u[w].length;v++){if(y[w][v]==x){A+=u[w][v]}else{t+="<tt"+(x||"")+">"+A+"</tt>";x=y[w][v];A=u[w][v]}}t+="<tt"+(x||"")+">"+A+"</tt>";if(++w<u.length){t+="<br>"}}z.html(t)},writeoldstyle:function(w,C,B){var D="",y=0,x,A,u;if(this.lines.length==this.linesseen&&this.lineswanted<this.linedivs.length){for(var v=this.lineswanted;v<this.linedivs.length;v++){this.linedivs[v].remove()}this.linedivs.length=this.lineswanted;if(this.lines.length>this.lineswanted){this.lines.length=this.lineswanted;this.styles.length=this.lineswanted}}if(C.length<this.linedivs.length){var z=function(E){E.fadeOut(400,function(){E.remove()})};for(var v=C.length;v<this.linedivs.length;v++){z(this.linedivs[v])}this.linedivs.length=C.length}while(y<C.length){D="";A="";u=B[y][0];for(x=0;x<C[y].length;x++){if(B[y][x]==u){A+=C[y][x]}else{D+="<tt"+(u||"")+">"+A+"</tt>";u=B[y][x];A=C[y][x]}}D+="<tt"+(u||"")+">"+A+"</tt>";if(y<this.linedivs.length){this.linedivs[y].html(D)}else{var t=c("<div>").html(D);w.append(t);this.linedivs[y]=t}this.linedivs[y].show();y++}if(this.lines.length>this.lineswanted){this.lines.length=this.lineswanted;this.styles.length=this.lineswanted}this.linesseen=this.lineswanted},addline:function(w){var v=this.io.env.width,t=[],u=0;w=w||this.lines.length;while(u++<v){t.push(" ")}this.lines[w]=t;this.styles[w]=Array(v)}});var p=function(t){return"\n"+Array(t.length).join("&ensp;")},m=function(t){return Array(t.length).join("\u00A0")+" "},n=function(z){var t=z.order,y=z.io.structures[t.name]||{node:"span"},x=t.node||y.node,A=t.text,w=c("<"+x+">").appendTo(z.target).addClass(t.name).css(t.css||{});if(t.css&&t.css.reverse){k(w)}if(A){A=A.replace(/( +) /g,m);A=A.replace(/^ /mg,"\u00A0");var v=A.split("\n");for(var u=0;u<v.length;u++){if(u!=0){w.append(c("<br>"))}if(v[u].length){w.append(document.createTextNode(v[u]))}}}if(y.func){y.func(w,z.io)}return false},r=/(\d+),\s*(\d+),\s*(\d+)/,d=Object.subClass({init:function(w){w=o({},w);this.env=w;var u=c(w.container),t=c('<tt class="TextGrid">00000</tt>').appendTo(u),y=t.height(),v=t.width()/5,x=Math.min(Math.floor(u.width()/v),w.width||80);t.remove();o(w,{charheight:y,charwidth:v,width:x,fgcolour:r.exec(u.css("color")).slice(1),bgcolour:r.exec(u.css("bgcolor")).slice(1)});u.width(x*v+2);this.container=u;this.target=u;u.on("stream",n);this.TextInput=new b(u,w.scrollparent);this.structures={main:{node:"div"},status:{node:"div",func:function(z,A){new a(z,A)}}}},event:function(w){var t,x,v,y=this.target,u;for(v=0;v<w.length;v++){t=w[v];x=t.code;if(x=="structures"){t.code=e;c.extend(this.structures,t)}if(x=="find"){this.target=y=c("."+t.name)}if(x=="stream"){(t.to?c("."+t.to):y).trigger({type:"stream",io:this,order:t})}if(x=="clear"){var u=t.name?c("."+t.name):y;u.empty();if(t.css&&t.css["background-color"]){if(t.name=="main"){if(this.env.colorparent){u=c(this.env.colorparent)}else{if(this.env.scrollparent){u=c(this.env.scrollparent)}else{u=l}}}u.css("background-color",t.css["background-color"])}}if(x=="read"){t.target=y;this.TextInput.getLine(t)}if(x=="char"){this.TextInput.getChar(t)}}}});h.StructIO=d;d.TextInput=b})(window,jQuery);var Runner=Object.subClass({init:function(c,b){var a=this;b=window.engine=this.e=new window[b]();this.io=new StructIO(c);this.toEngine=this.io.TextInput.callback=function(d){b.inputEvent(d)};b.outputEvent=function(d){a.fromEngine(d)}},fromParchment:function(b){var a=b.code;if(a=="load"){b.env=this.io.env}this.toEngine(b)},fromEngine:function(e){var d=this.e,c=0,a,f,b;this.io.event(e);for(;c<e.length;c++){a=e[c];f=a.code;if(f=="quit"){return}if(f=="save"||f=="restore"){this.toParchment(a)}if(f=="restart"){this.io.target=this.io.container.empty();b=1}if(f=="tick"){b=1}}if(b){this.toEngine(a)}}});jQuery.ajaxSetup({cache:1,converters:{"* binary":true}});jQuery.ajaxPrefilter("script",function(a){if(a.isLocal){a.crossDomain=1}});var parchment={options:{container:"#parchment",lib_path:"lib/",page_title:1,panels:["search","url","about"],proxy_url:"http://zcode.appspot.com/proxy/"},lib:{}},urloptions=(function(c){var d=0,a={},b;if(c[0]==""){d++}while(d<c.length){b=/([^=]+)(=(.*))?/.exec(c[d++]);a[b[1]]=b[3]?unescape(b[3]):true}return a})(location.search.slice(1).split(/[&;]/g));(function(a){window.FatalError=function(b){this.message=b;this.traceback=this._makeTraceback(arguments.callee);this.onError(this);if(a(".load").length>0){a(".load").detach()}};FatalError.prototype={onError:function(c){var b=c.message;a("#parchment").append('<div class="error">An error occurred:<br/><pre>'+b+"\n\n"+c.traceback+"</pre></div>");if(window.console){console.error(b)}},_makeTraceback:function(b){var f="";var d=0;var c=100;while(b!=null&&d<c){var g=b.toString();if(!g){f="\n  (anonymous function)"+f}else{var h=g.match(/function (\w*)/);if(!h||!h[1]){f="\n  (anonymous function)"+f}else{f="\n  "+h[1]+f}}try{b=b.caller}catch(i){b=null}d++}if(d==c){f="..."+f}return"Traceback (most recent call last):\n"+f}}})(jQuery);(function(g,e){if(g.execScript){execScript("Function VBCStr(x)\nVBCStr=CStr(x)\nEnd Function\nFunction VBLastAsc(x)\nDim l\nl=LenB(x)\nIf l mod 2 Then\nVBLastAsc=AscB(MidB(x,l,1))\nElse\nVBLastAsc=-1\nEnd If\nEnd Function","VBScript")}var f=/chrome\/(\d+)/i.exec(navigator.userAgent),d=f&&parseInt(f[1])>4,a=function(q,r){var r=r||[],p=0,o;for(o=q.length%8;p<o;++p){r.push(q.charCodeAt(p)&255)}for(o=q.length;p<o;){r.push(q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255,q.charCodeAt(p++)&255)}return r},l=function(p,o){return(o||"")+String.fromCharCode.apply(1,p)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=(function(){var o=[],p=0;for(;p<h.length;p++){o[h.charAt(p)]=p}return o})(),b=function(t,r){if(g.atob){return a(atob(t),r)}var r=r||[],u,q,p,y,x,w,v,s=0,o=t.length;while(s<o){y=c[t.charAt(s++)];x=c[t.charAt(s++)];w=c[t.charAt(s++)];v=c[t.charAt(s++)];u=(y<<2)+(x>>4);q=((x&15)<<4)+(w>>2);p=((w&3)<<6)+v;r.push(u,q,p)}if(v==64){r.pop()}if(w==64){r.pop()}return r},i=function(t,r){if(g.btoa){return btoa(l(t,r))}var r=r||"",u,q,p,y,x,w,v,s=0,o=t.length;while(s<o){u=t[s++];q=t[s++];p=t[s++];y=u>>2;x=((u&3)<<4)+(q>>4);w=((q&15)<<2)+(p>>6);v=p&63;r+=(h.charAt(y)+h.charAt(x)+h.charAt(w)+h.charAt(v))}if(isNaN(q)){r=r.slice(0,-2)+"=="}else{if(isNaN(p)){r=r.slice(0,-1)+"="}}return r},j=function(t){var u=VBCStr(t),s=VBLastAsc(t),o=[],q=0,p=u.length%4,r;while(q<p){o.push((r=u.charCodeAt(q++))&255,r>>8)}p=u.length;while(q<p){o.push((r=u.charCodeAt(q++))&255,r>>8,(r=u.charCodeAt(q++))&255,r>>8,(r=u.charCodeAt(q++))&255,r>>8,(r=u.charCodeAt(q++))&255,r>>8)}if(s>-1){o.push(s)}return o},m=jQuery.ajaxSettings.xhr(),k={binary:m.overrideMimeType&&!(e.browser.opera&&parseFloat(e.browser.version)<10.5)?"charset":"responseBody" in m?"responseBody":0},n=function(q,t,p){var s,o,r;q=e.trim(q);if(p.mode=="base64"){if(g.atob){r=atob(q);s=a(r)}else{s=b(q)}}else{if(p.mode=="charset"){s=a(q)}else{s=j(p.xhr.responseBody)}}p.responseArray=s;p.responseText=r};m=undefined;e.ajaxPrefilter("binary",function(p,s,q){var r=p.isLocal&&!p.crossDomain&&d?0:k.binary,o=p.xhr;p.xhr=function(){return q.xhr=o.apply(p)};p.binary=r;q.done(n);p.jsonp=false;p.jsonpCallback="processBase64Zcode";q.mode="base64";if(p.url.slice(-3).toLowerCase()==".js"){return"jsonp"}if(r&&!p.crossDomain){return"text"}if(p.legacy){p.url=p.legacy;return"jsonp"}p.data="url="+p.url;p.url=parchment.options.proxy_url;if(r&&e.support.cors){return"text"}p.data+="&encode=base64&callback=pproxy";p.jsonpCallback="pproxy";return"jsonp"});e.ajaxPrefilter("text",function(o,q,p){p.mode=o.binary;if(p.mode=="charset"){o.mimeType="text/plain; charset=x-user-defined"}});g.file={text_to_array:a,array_to_text:l,base64_decode:b,base64_encode:i,support:k}})(window,jQuery);(function(b){var a=this,c='<p><a href="'+location.href+"?story=http://mirror.ifarchive.org/",d=function(e){return c+e.path+'">'+e.desc+"</a></p>"};parchment.lib.UI=Object.subClass({init:function(e){this.library=e;this.panels={};this.load_indicator=b('<div class="dialog load"><p>Parchment is loading.<p>&gt; <blink>_</blink></div>')},stylesheet_add:function(){var e=arguments,f;for(f=1;f<e.length;f++){if(document.createStyleSheet){document.createStyleSheet(e[f])}else{b("<link>",{rel:"alternate stylesheet",href:e[f],title:e[0],type:"text/css"}).appendTo("head")[0].disabled=true}}},stylesheet_switch:function(f,e){b('link[rel*="stylesheet"][title="'+f+'"]').each(function(){this.disabled=!e})},load_panels:function(){var e=parchment.options.panels,i,h,g,f=function(){var k=RegExp(h.val().replace(" ","( )?"),"i"),j=b.grep(i,function(l){return k.test(l.path+l.desc)});j=j.slice(0,30);g.html(b.map(j,d).join(""))};if(b.inArray("search",e)!=-1){this.panels.search=b('<div class="panel search"><label for="panel_search">Search the IF Archive for games you can play with Parchment. You might also like to search the <a href="http://ifdb.tads.org">IFDB</a> or the <a href="http://ifwiki.org">IF Wiki</a>.</label><input id="panel_search"><div></div></div>');h=this.panels.search.find("input");g=h.next();h.keydown(function(){h.unbind("keydown");b.getJSON("stories/if-archive.json").done(function(j){i=j;h.keyup(f);f()})})}if(b.inArray("url",e)!=-1){this.panels.url=b('<form class="panel url"><label for="panel_url">You may use Parchment to play any story file on the internet, simply copy its address here:</label><input id="panel_url" name="story"></form>')}this.library.container.append(this.panels[e[0]]);this.panels.active=e[0]}})})(jQuery);(function(e,c){var g=/([-\w\s_]+)(\.[\w]+(\.js)?)?$/,i=/\.js$/,d=function(){throw new FatalError("Parchment could not load the story. Check your connection, and that the URL is correct.")},f=function(k){c(".load").detach();var l=e.runner=new (e[k[2].vm.runner]||Runner)(parchment.options,k[2].vm.engine),j=location.hash;l.toParchment=function(m){k[2].library.fromRunner(l,m)};l.fromParchment({code:"load",data:(new parchment.lib.Story(k[2].responseArray)).data});if(j&&j!="#"){l.fromParchment({code:"restore",data:file.base64_decode(j.slice(1))})}else{l.fromParchment({code:"restart"})}};parchment.lib.Story=IFF.subClass({init:function h(p,k){this.title=k;if(p[0]<9){this._super();this.chunks.push({type:"ZCOD",data:p});this.data=p}else{if(IFF.text_from(p,0)=="Glul"){this._super();this.chunks.push({type:"GLUL",data:p});this.data=p}else{if(IFF.text_from(p,0)=="FORM"){this._super(p);if(this.type=="IFRS"){for(var n=0,j=this.chunks.length;n<j;n++){var o=this.chunks[n].type;if(o=="ZCOD"&&!this.zcode){this.data=this.chunks[n].data}else{if(o=="GLUL"&&!this.glulx){this.data=this.chunks[n].data}else{if(o=="IFmd"){this.metadata=file.array_to_text(this.chunks[n].data);var m=c(this.metadata);if(m){if(c("title",m)){this.title=c("title",m).text()}if(c("ifid",m)){this.ifid=c("ifid",m).text()}if(c("release",m)){this.release=c("release",m).text()}}}}}}}}}}}});var a=Object.subClass({add:function(j){this[j.ifid]=j;if(j.url){this.url[j.url]=j}},url:{}}),b=Object.subClass({init:function(){this.container=c(parchment.options.container);this.ui=new parchment.lib.UI(this)},load:function(q){var j=this,l=parchment.options,o=urloptions.story,k,n=urloptions.vm,m=0;if(l.lock_story){o=l.default_story;if(!o){throw new FatalError("Story file not specified")}}else{if(l.default_story||o){o=o||l.default_story}else{return this.ui.load_panels()}}c("#about").remove();c("body").append(j.ui.load_indicator);if(!c.isArray(o)){o=[o,0]}k=o[0];j.url=k;storyName=g.exec(k);storyName=storyName?storyName[1]+" - Parchment":"Parchment";if(l.page_title){e.document.title=storyName}if(n){n=parchment.vms[n]}else{for(;m<parchment.vms.length;m++){if(parchment.vms[m].match.test(k)){n=parchment.vms[m];break}}}if(!n){throw new FatalError("File type is not supported!")}try{this.launch(n,o)}catch(p){throw new FatalError(p)}},launch:function(n,o){var k=this,p=[c.ajax(o[0],{dataType:"binary",legacy:o[1]}).done(function(r,s,q){q.library=k;q.vm=n}).fail(d)],j=[],m=0,l;if(!n.loaded){n.loaded=1;while(m<n.files.length){l=parchment.options.lib_path+n.files[m++];if(i.test(l)){j.push(c.getScript(l))}else{this.ui.stylesheet_add(n.id,l)}}p[1]=c.when.apply(1,j)}c.when.apply(1,p).done(f)},fromRunner:function(m,l){var k=l.code,j=location.hash;if(k=="save"){location.hash=file.base64_encode(l.data)}if(k=="restore"){if(j&&j!="#"){l.data=file.base64_decode(j.slice(1))}}m.fromParchment(l)},stories:new a(),savefiles:{}});parchment.lib.Library=b;parchment.vms=[];parchment.add_vm=function(j){parchment.vms.push(j);parchment.vms[j.id]=j}})(window,jQuery);parchment.add_vm({id:"gnusto",match:/(z[1-8]|zlb|(z|zcode.+)(blorb|blb))(.js)?$/i,files:["gnusto.min.js"],runner:"GnustoRunner"});(function(a,b){var c=a.parchment;b(function(){var d;if(a.parchment_options){b.extend(c.options,parchment_options)}if(!c.options.lock_options&&urloptions.options){b.extend(c.options,b.parseJSON(urloptions.options))}d=new c.lib.Library();c.library=d;d.load();if(location.href.indexOf("iplayif.com")!=-1){b.getScript("http://google-analytics.com/ga.js",function(){_gat._getTracker("UA-7949545-3")._trackPageview()})}})})(this,jQuery);